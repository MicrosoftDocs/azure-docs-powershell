---
external help file: Microsoft.WindowsAzure.Commands.ServiceManagement.dll-Help.xml
online version: http://go.microsoft.com/fwlink/?LinkID=402843
schema: 2.0.0
---

# Set-AzureServiceAntimalwareExtension

## SYNOPSIS
Configures the Microsoft Antimalware extension for cloud services.

## SYNTAX

### SetExtension (Default)
```
Set-AzureServiceAntimalwareExtension [-ServiceName] <String> [[-Slot] <String>] [[-Role] <String[]>]
 [[-AntimalwareConfiguration] <XmlDocument>] [[-Monitoring] <String>] [[-StorageContext] <AzureStorageContext>]
 [-Profile <AzureProfile>] [<CommonParameters>]
```

### SetExtensionUsingThumbprint
```
Set-AzureServiceAntimalwareExtension [-ServiceName] <String> [[-Slot] <String>] [[-Role] <String[]>]
 [[-AntimalwareConfiguration] <XmlDocument>] [[-Monitoring] <String>] [[-StorageContext] <AzureStorageContext>]
 [-Profile <AzureProfile>] [<CommonParameters>]
```

## DESCRIPTION
The **Set-AzureServiceAntimalwareExtension** cmdlet configures the Microsoft Antimalware extension for a cloud service.
You can specify values that override and supplement values in the XML configuration, such as storage account context.

## EXAMPLES

### Example 1: Enable the extension
```
PS C:\>[System.Xml.XmlDocument] $XmlConfig = New-Object System.Xml.XmlDocument 
PS C:\> $XmlConfig.load('C:\configuration\contosoVM.xml')
PS C:\> Set-AzureServiceAntimalwareExtension -ServiceName "ContosoService03" -AntimalwareConfiguration $XmlConfig
Operation succeeded
```

The first two commands create an **XmlDocument** object that contains a configuration for the Microsoft Antimalware extension, and then stores it in the $XmlConfig variable.

The third command enables the Microsoft Antimalware extension for the service named ContosoService03, by using the configuration stored in $XmlConfig.
Because the command does not specify the *Slot* parameter, the cmdlet uses the default value, Production.

### Example 2: Enable the extension for the Staging slot
```
PS C:\>[System.Xml.XmlDocument] $XmlConfig = New-Object System.Xml.XmlDocument 
PS C:\> $XmlConfig.load('C:\configuration\contosoVM.xml')
PS C:\> Set-AzureServiceAntimalwareExtension -ServiceName "ContosoService03" -Slot "Staging" -AntimalwareConfiguration $XmlConfig 
Operation succeeded
```

The first two commands create an **XmlDocument** object that contains a configuration for the Microsoft Antimalware extension, and then stores it in the $XmlConfig variable.

The third command enables the Microsoft Antimalware extension for the service named ContosoService03, by using the configuration stored in $XmlConfig.
This command specifies a value of Staging for the *Slot* parameter.

### Example 3: Enable the extension with monitoring
```
PS C:\>[System.Xml.XmlDocument] $XmlConfig = New-Object System.Xml.XmlDocument 
PS C:\> $XmlConfig.load('C:\configuration\contosoVM.xml')
PS C:\> $StorageContext = New-AzureStorageContext -StorageAccountName "contosostoragemain" -StorageAccountKey (Get-AzureStorageKey -StorageAccountName "Contosostoragemain").Primary
PS C:\> Set-AzureServiceAntimalwareExtension -ServiceName "ContosoService03" -AntimalwareConfiguration $XmlConfig -Monitoring ON -StorageContext $StorageContext
```

The first two commands create an **XmlDocument** object that contains a configuration for the Microsoft Antimalware extension, and then stores it in the $XmlConfig variable.

The third command creates an **AzureStorageContext** object by using the **New-AzureStorageContext** cmdlet, and then stores it in the $StorageContext variable.

The final command enables the Microsoft Antimalware extension for the service named ContosoService03, by using the configuration stored in $XmlConfig.
This command also specifies a value of ON for the *Monitoring* parameter and specifies the Azure storage context stored in $StorageContext.
The values specified by these parameters override any corresponding values for these parameters that were specified within the XML configuration.

## PARAMETERS

### -ServiceName
Specifies the name of the cloud service.

```yaml
Type: String
Parameter Sets: (All)
Aliases: 

Required: True
Position: 0
Default value: None
Accept pipeline input: True (ByPropertyName)
Accept wildcard characters: False
```

### -Slot
Specifies a deployment slot.
Valid values are: 

- Production
- Staging

The default value is Production.

```yaml
Type: String
Parameter Sets: (All)
Aliases: 

Required: False
Position: 1
Default value: None
Accept pipeline input: True (ByPropertyName)
Accept wildcard characters: False
```

### -Role
Specifies an array of roles.
The default value is all roles.

```yaml
Type: String[]
Parameter Sets: (All)
Aliases: 

Required: False
Position: 2
Default value: None
Accept pipeline input: True (ByPropertyName)
Accept wildcard characters: False
```

### -AntimalwareConfiguration
Specifies an **XmlDocument** object that contains the Microsoft Antimalware configuration.
This object must not be $Null or empty.
The configuration object must include, at a minimum, the following content to enable the Microsoft Antimalware extension: 

\<AntimalwareConfig\>\<AntimalwareEnabled\>true\</AntimalwareEnabled\>\</AntimalwareConfig\>

You can configure the following settings in this configuration file: 

Setting: \<AntimalwareEnabled\>
Values: true (case sensitive) 
A value of true enables the Microsoft Antimalware extension.
The value false is not supported.
This setting is required. 
Default: None

Setting: \<RealtimeProtectionEnabled\>
Values: true or false (case sensitive) 
A value of true enables Real-time protection.
A value of false disables Real-time protection. 
Default: true when \<AntimalwareEnabled\> has a value of true. 

Setting: \<ScheduledScanSettings\> **isEnabled** attribute
Values: true or false (case sensitive) 
Enables or disables a periodic scan for active malware. 
Default: false

Setting: \<ScheduledScanSettings\> **day** attribute
Values: 0 through 8

 -- 0: Scan daily
- 1: Scan Sunday
- 2: Scan Monday
- 3: Scan Tuesday
- 4: Scan Wednesday
- 5: Scan Thursday
- 6: Scan Friday
- 7: Scan Saturday
- 8: Disabled

Default: 7 if you specify a value of true for the **isEnabled** attribute of \<ScheduledScanSettings\>

Setting: \<ScheduledScanSettings\> **time** attribute 
Values: 0 through 1440
Specify the hour at which to begin the scan in increments of 60 minutes after midnight.
Specify a value of 60 for 1:00 A.M. 
Default: 120 if you specify a value of true for the **isEnabled** attribute of \<ScheduledScanSettings\> 

Setting: \<ScheduledScanSettings\> **scanType** attribute
Values: Quick or Full
Default: Quick if you specify a value of true for the **isEnabled** attribute of \<ScheduledScanSettings\> 

Setting: Exclusions for file name extensions
Values: File name extensions
List the file name extensions to exclude from scanning.
To exclude files that have the file name extensions .gif, .log, or .txt, specify the following text: 

gif, log, txt

For cloud service XML configuration, add each file name extension as a separate row element value in your configuration XML.
In JavaScript Object Notation (JSON) configuration, add all file name extensions as a semicolon separated list. 
Default: None

Setting: Exclusions for paths
Values: File and folder paths
Description: List the paths of files or folders to exclude from scanning.
To exclude the file worker.dll in the e:\approot folder and anything under the folder e:\approot\temp, specify the following paths: 

e:\approot\worker.dll, e:\approot\temp

For JSON configuration for virtual machines, use a second slash as an escape character for the slash, as in e:\\\\approot\\\\worker.dll. 
Add each excluded path as a separate row element value in your configuration XML.
In JSON configuration, add all excluded paths as a semicolon separated list. 
Default: None

Setting: Exclusions for processes
Values: Process names
List the process exclusions.
The Microsoft Antimalware extension does not scan any file that an excluded process opens.
The Microsoft Antimalware extension scans the process itself.
To exclude the process itself, use the \<Paths\> element.
The Microsoft Antimalware extension excludes from scanning any file opened by the MyApp.exe based on this example: 

C:\Program Files\MyApp.exe

Add each excluded process as a separate row element value in your configuration XML. 
Default: None

Setting: \<Monitoring\>
Values: ON or OFF
A value of ON enables antimalware monitoring using the Azure diagnostics extension.
A value of OFF disables antimalware monitoring by removing antimalware monitoring configuration if it was previously ON. 
Default: OFF

Setting: \<StorageAccountName\>
Values: Storage account name
Specifies the name of the storage account for your Azure store table to collect antimalware events in storage.
If you specified a value of ON for \<Monitoring\>, you must specify a storage account name. 
Default: None

The following is an example of a configuration file that contains additional settings: 

\<AntimalwareConfig\>
    \<AntimalwareEnabled\>true\</AntimalwareEnabled\> 
    \<RealtimeProtectionEnabled\>true\</RealtimeProtectionEnabled\>     
    \<ScheduledScanSettings isEnabled="true" day="7" time="120" scanType="Quick" /\> 
    \<Exclusions\> 
        \<Extensions\>
\<Extension\>.ext1\</Extension\>
\<Extension\>.ext2\</Extension\>
        \</Extensions\>
        \<Paths\>
\<Path\>c:\excluded-path-1\</Path\>
\<Path\>c:\excluded-path-2\</Path\>
        \</Paths\>
        \<Processes\>
\<Process\>excludedproc1.exe\</Process\>
\<Process\>excludedproc2.exe\</Process\>
        \</Processes\>
    \</Exclusions\>
    \<Monitoring\>ON\</Monitoring\>
    \<StorageAccountName\>contosostorage\</StorageAccountName\>
\</AntimalwareConfig\>  

We do not recommend the use of wildcard characters in the exclusion settings.

```yaml
Type: XmlDocument
Parameter Sets: (All)
Aliases: 

Required: False
Position: 3
Default value: None
Accept pipeline input: True (ByPropertyName)
Accept wildcard characters: False
```

### -Monitoring
Specifies whether to collect Microsoft Antimalware events.
Valid values are: 

- ON.
Collect Microsoft Antimalware events to storage context.
- OFF.
Do not collect Microsoft Antimalware events.

```yaml
Type: String
Parameter Sets: (All)
Aliases: 

Required: False
Position: 4
Default value: None
Accept pipeline input: True (ByPropertyName)
Accept wildcard characters: False
```

### -StorageContext
Specifies an Azure storage context for Microsoft Antimalware monitoring.
You must specify a valid storage context when monitoring is set to ON.

```yaml
Type: AzureStorageContext
Parameter Sets: (All)
Aliases: 

Required: False
Position: 5
Default value: None
Accept pipeline input: True (ByPropertyName)
Accept wildcard characters: False
```

### -Profile
In-memory profile.```yaml
Type: AzureProfile
Parameter Sets: (All)
Aliases: 

Required: False
Position: Named
Default value: None
Accept pipeline input: False
Accept wildcard characters: False
```

### CommonParameters
This cmdlet supports the common parameters: -Debug, -ErrorAction, -ErrorVariable, -InformationAction, -InformationVariable, -OutVariable, -OutBuffer, -PipelineVariable, -Verbose, -WarningAction, and -WarningVariable. For more information, see about_CommonParameters (http://go.microsoft.com/fwlink/?LinkID=113216).

## INPUTS

## OUTPUTS

## NOTES

## RELATED LINKS

[Get-AzureServiceAntimalwareConfig](.\Get-AzureServiceAntimalwareConfig.md)

[Remove-AzureServiceAntimalwareExtension](.\Remove-AzureServiceAntimalwareExtension.md)

